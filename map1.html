<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
    <style>
        body {
            margin: 0;
        }

        img {
            float: left;
            padding-right: 10px;
        }

        p {
            font-size: 15px;
            line-height: 25px;
        }

        #wrapper {
            width: 715px;
        }

        #map {
            width: 695px;
            margin: 0 auto;
            height: 375px;
        }

        #controls {
            width: 100%;
            margin: 0 auto;
            padding: 15px;
        }

        #header {
            margin-top: 0;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
<!-- Our web map and content will go here -->
<div id="wrapper">
    <div id="header">
        <h1><img src="images/map-logo.png" alt="Coffee Cup Logo" style="height: 38px; width: 38px;">Rodent Violations -
            Cambridge, MA</h1>
    </div>
    <div id="map"></div>
    <div id="controls">
        <button class="button" id="toggleButton">Display Rodent Violations</button>
        <div id="credits"><p>&copy;#webMapWorkshop - Mike Foster, 2015</p></div>
    </div>

</div>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>
    // Create Map Object
    var map = L.map('map', {center: [42.380754, -71.110236], zoom: 13});

    // Add Tile Layer from MAPC and MassGIS
    L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png', {
        attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
        maxZoom: 17,
        minZoom: 9
    }).addTo(map);

    // Add Rodent Violation GeoJSON Data
    // Null variable that will hold rodent violation data
    var violationPoints = null;

    // Get GeoJSON and put it on the map when it loads
    $.getJSON("data/rodent_violations.geojson", function(data) {

        // set violationPoints to the dataset, and add the rodent violation GeoJSON layer to the map
        violationPoints = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.address);
            }, pointToLayer: function (feature, latlng) {
                var marker = null;
                if (feature.properties.status == "Cited") {
                    marker = L.marker(latlng, {icon: citedIcon});
                } else {
                    marker = L.marker(latlng, {icon: correctedIcon});
                }
                return marker;
            }
        }).addTo(map);
    });

    // Create Custom Icons Here
    // Rodent Icon Class
    var RodentIcon = L.Icon.extend({
        options: {
            shadowUrl: 'images/rodent_shadow.png',
            iconSize: [36, 36],
            shadowSize: [36, 36],
            iconAnchor: [18, 18],
            shadowAnchor: [18, 18],
            popupAnchor: [0, -6]
        }
    });

    // Create specific icons
    var citedIcon = new RodentIcon({iconUrl: 'images/rodent_open.png'});
    var correctedIcon = new RodentIcon({iconUrl: 'images/rodent.png'});

    // Null variable that will hold neighborhoods layer
    var neighborhoodsLayer = null;

    // Add Neighborhood Polygons
    $.getJSON("data/cambridge_neighborhoods.geojson", function (data) {
        neighborhoodsLayer = L.geoJson(data).addTo(map);
    });
</script>
</body>
</html>